- name: Run cocotb (icarus via Makefile)
  env:
    COCOTB_RESULTS_FILE: test/results.xml
  run: |
    make -C test SIM=icarus WAVES=1 \
      TOPLEVEL=tt_um_sfg_cdr TOPLEVEL_LANG=verilog \
      VERILOG_SOURCES="../cdr.v ../project.v" \
      MODULE=test

- name: Upload artifacts (always)
  if: always()
  uses: actions/upload-artifact@v4
  with:
    name: sim-artifacts
    path: |
      test/results.xml
      test/sim_build/**/*.vcd
    if-no-files-found: warn
